import{c as y,v as C,j as e,b as k,d as S,r as x,a as N}from"./index-D4G8WBXc.js";import{S as j,T as V}from"./TransactionFilters-B5UASYfx.js";import{a as A}from"./calculate-balance-D-teRt_A.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]],D=y("download",T);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]],w=y("file",F);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],L=y("upload",M);function U(s){if(s.length===0)return"";const c=r=>r.replace(/_/g," ").replace(/\w\S*/g,a=>a.charAt(0).toUpperCase()+a.slice(1).toLowerCase()),t=Object.keys(s[0]),n=t.map(c).join(","),o=s.map(r=>t.map(a=>`"${String(r[a]).replace(/"/g,'""')}"`).join(",")).join(`
`);return`${n}
${o}`}const E=s=>{const c=s.trim().split(/\r?\n/);if(c.length<2)return[];const t=c[0].split(",").map(n=>n.trim().toLowerCase());return c.slice(1).map(n=>{const o=n.split(",").map(a=>a.trim().replace(/^"|"$/g,"").replace(/""/g,'"')),r={};return t.forEach((a,d)=>{r[a]=o[d]??""}),{id:r.id??C(),date:r.date,amount:parseFloat(r.amount)||0,description:r.description||"",type:r.type||"Deposit"}})},R=(s,c)=>{var n;const t=new Map;for(const o of s)t.set(o.id,o);for(const o of c){const r=((n=o.id)==null?void 0:n.trim())||C();t.set(r,{...o,id:r})}return Array.from(t.values())},g=({onClick:s})=>e.jsxs("button",{type:"button",onClick:s,"aria-label":"Upload CSV file",className:"text-sm flex items-center justify-center gap-2 px-2 py-2 border border-rose-base text-rose-base rounded-md transition-colors hover:border-rose-hover hover:text-rose-hover active:border-rose-active active:text-rose-active focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",children:[e.jsx(L,{size:15,"aria-hidden":"true"}),"Upload CSV"]});g.handleFileChange=(s,c,t,n)=>{var d;const o=(d=s.target.files)==null?void 0:d[0];if(!o)return;if(!(o.type==="text/csv"||o.name.toLowerCase().endsWith(".csv"))){n({type:"error",message:"Please upload a valid CSV file."}),s.target.value="";return}const a=new FileReader;a.onload=h=>{var u;const m=(u=h.target)==null?void 0:u.result;if(typeof m=="string")try{const p=E(m),i=R(c,p);t({type:"SET",payload:i}),n({type:"success",message:"CSV uploaded successfully."})}catch(p){n({type:"error",message:"Error uploading CSV."}),console.error(p)}},a.readAsText(o),s.target.value=""};const _=({transactions:s,showAlert:c})=>{const t=()=>{if(!s||s.length===0){alert("No transactions to download.");return}const n=U(s),o=new Blob([n],{type:"text/csv;charset=utf-8;"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.setAttribute("download","transactions.csv"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(r),c({type:"success",message:"CSV downloaded successfully."})};return e.jsxs("button",{type:"button",onClick:t,"aria-label":"Download CSV file",className:"text-sm flex items-center justify-center gap-2 px-2 py-2 border border-rose-base text-rose-base rounded-md transition-colors hover:border-rose-hover hover:text-rose-hover active:border-rose-active active:text-rose-active focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2",children:[e.jsx(D,{size:15,"aria-hidden":"true"}),"Download CSV"]})},$=()=>{const{state:{transactions:s},dispatch:c}=k("CSVManage"),{showAlert:t}=S(),n=x.useRef(null),o=()=>{var r;(r=n.current)==null||r.click()};return e.jsxs(e.Fragment,{children:[e.jsx("input",{type:"file",accept:".csv",ref:n,onChange:r=>g.handleFileChange(r,s,c,t),className:"hidden","aria-hidden":"true"}),e.jsxs("div",{className:"flex sm:flex-row flex-wrap gap-2 mb-4",children:[e.jsx(g,{onClick:o,transactions:s,dispatch:c,showAlert:t}),e.jsx(_,{transactions:s,showAlert:t})]})]})},f=20,H=()=>{const{state:{transactions:s}}=k("History"),{currency:c}=N(),[t,n]=x.useState({from:"",to:"",type:"All",description:"",page:1}),[o,r]=x.useState(!1),[a,d]=x.useState(!1),h=i=>{n({...t,[i.target.name]:i.target.value,page:1})},m=x.useMemo(()=>s.filter(i=>{const l=new Date(i.date),v=t.from?new Date(t.from):null,b=t.to?new Date(t.to):null;return(!v||l>=v)&&(!b||l<=b)&&(t.type==="All"||i.type===t.type)&&i.description.toLowerCase().includes(t.description.toLowerCase())}).sort((i,l)=>new Date(l.date).getTime()-new Date(i.date).getTime()),[s,t]),u=m.slice((t.page-1)*f,t.page*f),p=Math.ceil(m.length/f);return e.jsxs("section",{className:"w-full max-w-3xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4 px-2",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Transactions"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("button",{onClick:()=>r(!o),className:"text-sm text-rose-base hover:text-color-rose-hover cursor-pointer",children:o?e.jsx(j,{color:"#ef1660"}):e.jsx(j,{color:"#A3A3A3"})}),e.jsx("button",{onClick:()=>d(!a),className:"text-sm text-rose-base hover:text-color-rose-hover cursor-pointer",children:a?e.jsx(w,{color:"#ef1660"}):e.jsx(w,{color:"#A3A3A3"})})]})]}),o&&e.jsx(V,{filter:t,onChange:h}),a&&e.jsx($,{}),e.jsx("div",{className:"h-[600px] overflow-y-auto space-y-2 pr-1 scroll-smooth scroll-hidden",children:u.length>0?u.map(i=>e.jsxs("div",{className:"p-4 border border-gray-300 dark:border-gray-100 rounded shadow-sm flex justify-between items-center bg-white dark:bg-background-dark hover:bg-gray-100 dark:hover:bg-gray-300 cursor-pointer",children:[e.jsx("div",{className:"w-[35%]",children:e.jsx("p",{className:"font-bold text-sm text-gray-800 dark:text-gray-100",children:i.date})}),e.jsx("div",{className:"w-[40%]",children:e.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-gray-100",children:i.description})}),e.jsxs("div",{className:`text-sm font-bold w-[25%] ${i.type==="Deposit"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[A(c,i.amount).toFixed(2),c==="EUR"?"â‚¬":"$"]})]},i.id)):e.jsx("p",{className:"text-center text-gray-400 text-sm mt-10",children:"No hay transacciones para mostrar."})}),p>1&&e.jsx("div",{className:"mt-4 flex justify-center gap-2",children:Array.from({length:p}).map((i,l)=>e.jsx("button",{onClick:()=>n({...t,page:l+1}),className:`px-3 py-1 rounded border text-sm transition ${t.page===l+1?"bg-rose-base text-white":"bg-white dark:bg-gray-700 text-gray-800 dark:text-white"}`,children:l+1},l))})]})};function O(){return e.jsx("main",{className:"",children:e.jsx(H,{})})}export{O as default};
